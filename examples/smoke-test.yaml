name: smoke-test
description: "Comprehensive Smoke Test: All Modules"

settings:
  logging:
    level: INFO

steps:
  # 1. Discover
  - id: discover
    module: DiscoveryModule
    config:
      catalog_url: "https://stac.easierdata.info/"
      collection_ids: ["HLSS30_2.0"]

  # 2. Ingest (Limit 3)
  - id: ingest
    module: IngestModule
    depends_on: ["discover"]
    config:
      limit: 3
  
  # 3. Transform (Raw -> Intermediate)
  - id: transform
    module: TransformModule
    depends_on: ["ingest"]
    config:
      strategy: "merge"
      mappings:
        # Keep it simple, just ensure ID is there. 
        # Real scenario: mapping raw API fields to STAC fields if they weren't already STAC.
        # Here we just pass through mostly.
        - source_field: "id"
          target_field: "id"
          type: "string"

  # 4. Scaffold (Structure)
  - id: scaffold
    module: ScaffoldModule
    depends_on: ["transform"]
    config:
      mode: "items"
      defaults:
        license: "CC-BY-4.0"

  # 5. Update (Patching)
  - id: update
    module: UpdateModule
    depends_on: ["scaffold"]
    config:
      mode: "merge"
      updates:
        "properties.smoke_test_passed": true

  # 6. Validate
  - id: validate
    module: ValidateModule
    depends_on: ["update"]
    config:
      strict: false

  # 7. Output
  - id: output
    module: OutputModule
    depends_on: ["validate"]
    config:
      format: "json"
      output_path: "data/output/smoke_test"
